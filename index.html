<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯»å®å¤§å†’é™© </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #2c3e50;
            color: #ecf0f1;
            line-height: 1.6;
            min-height: 100vh;
            background-image: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
        }
        
        /* åˆ†åŒºå¸ƒå±€ - æ•´ä½“å®¹å™¨ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* é¡¶éƒ¨æ ‡é¢˜åŒº */
        h1 {
            text-align: center;
            color: #f1c40f;
            font-size: 2.5em;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            font-weight: bold;
            margin: 0;
        }
        
        /* ä¸­é—´ä¸»ä½“åŒº - å·¦å³å¸ƒå±€ */
        .game-panel {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex-wrap: wrap;
        }
        
        /* å·¦ä¾§æ•´ä½“åŒºåŸŸ - å‚ç›´æ’åˆ—åœ°å›¾å’Œæ—¥å¿— */
        .left-section {
            display: flex;
            flex-direction: column;
            flex: 2;
        }

        /* å·¦ä¾§åœ°å›¾åŠ¨ç”»åŒº - å‡å°‘ç©ºç™½ */
        .map-container {
            background-color: rgba(255,255,255,0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 15px;
            position: relative;
            min-height: 280px;
            max-height: 280px;
            min-width: 400px;
            max-width: 100%;
        }
        
        /* å³ä¾§ä¿¡æ¯åŒº - å‚ç›´å¸ƒå±€ */
        .info-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 280px;
            max-width: 350px;
        }
        
        /* çŠ¶æ€åŒºåŸŸ */
        .status-container {
            width: 100%;
            background-color: rgba(255,255,255,0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 20px;
            color: #2c3e50;
        }
        
        /* æ§åˆ¶åŒºåŸŸ */
        .controls-container {
            width: 100%;
            background-color: rgba(255,255,255,0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }
        
        /* åº•éƒ¨æ—¥å¿—åŒº */
        .log-container {
            background-color: rgba(255,255,255,0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 0;
        }
        

        
        .treasure-map {
            width: 100%;
            height: 250px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="800" height="250"><defs><linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%238b4513;stop-opacity:0.3" /><stop offset="100%" style="stop-color:%23a0522d;stop-opacity:0.5" /></linearGradient></defs><rect width="100%" height="100%" fill="url(%23bgGrad)"/><path d="M50,50 L750,50 L750,200 L50,200 Z" fill="none" stroke="%238b4513" stroke-width="4"/><path d="M120,125 L220,125 L320,125 L480,125 L780,125" stroke="%238b4513" stroke-width="2" stroke-dasharray="10,5"/><circle cx="120" cy="125" r="20" fill="%238b4513" opacity="0.8"/><text x="120" y="160" font-size="14" fill="%238b4513" font-weight="bold" text-anchor="middle">å›¾ä¹¦é¦†</text><circle cx="220" cy="125" r="20" fill="%238b4513" opacity="0.8"/><text x="220" y="160" font-size="14" fill="%238b4513" font-weight="bold" text-anchor="middle">å·¥ä¼š</text><circle cx="320" cy="125" r="20" fill="%238b4513" opacity="0.8"/><text x="320" y="160" font-size="14" fill="%238b4513" font-weight="bold" text-anchor="middle">æ£®æ—</text><circle cx="480" cy="125" r="20" fill="%238b4513" opacity="0.8"/><text x="480" y="160" font-size="14" fill="%238b4513" font-weight="bold" text-anchor="middle">ç¥åº™</text><circle cx="780" cy="125" r="20" fill="%23ffd700" opacity="0.8"/><text x="780" y="160" font-size="14" fill="%238b4513" font-weight="bold" text-anchor="middle">å®è—ç‚¹</text></svg>') no-repeat center center;
            background-size: 100% 100%;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }
        
        /* ç®€åŒ–çš„ç©å®¶æ ·å¼ - ä¼˜åŒ–åˆå§‹ä½ç½® */
        .player {
            width: 30px;
            height: 30px;
            background-color: #e74c3c;
            border: 3px solid white;
            border-radius: 50%;
            position: absolute;
            top: 110px; /* ä¸æ–°åœ°å›¾åœ†åœˆä¸­å¿ƒå¯¹é½ */
            left: 105px; /* ä¸æ–°åœ°å›¾åœ†åœˆä¸­å¿ƒå¯¹é½ */
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* ç®€åŒ–çš„å®ˆå«æ ·å¼ */
        .guard {
            width: 25px;
            height: 25px;
            background-color: #3498db;
            border: 2px solid white;
            position: absolute;
            top: 122px;
            left: 462px;
            opacity: 0;
            z-index: 9;
        }
        
        /* ç®€åŒ–çš„å®è—æ ·å¼ */
        .treasure {
            width: 20px;
            height: 20px;
            background-color: #ffd700;
            border: 2px solid #ffed4e;
            border-radius: 50%;
            position: absolute;
            top: 125px;
            left: 785px;
            opacity: 0;
            z-index: 8;
        }
        
        /* ç®€åŒ–çš„æ‰“æ‰‹æ ·å¼ */
        .helper {
            width: 18px;
            height: 18px;
            background-color: #2ecc71;
            border: 2px solid white;
            border-radius: 50%;
            position: absolute;
            opacity: 0.9;
            z-index: 7;
        }
        
        /* é‡‘å¸åŠ¨ç”» */
        .coin {
            width: 15px;
            height: 15px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15"><circle cx="7.5" cy="7.5" r="7" fill="%23ffd700" stroke="%23ffed4e" stroke-width="1"/><text x="7.5" y="10" text-anchor="middle" fill="%238b4513" font-size="8" font-weight="bold">$</text></svg>') no-repeat center center;
            position: absolute;
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 15;
        }
        
        .coin.appear {
            opacity: 1;
            animation: coinFloat 1.5s ease-out forwards;
        }
        
        @keyframes coinFloat {
            0% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
            50% { 
                opacity: 1; 
                transform: translateY(-20px) scale(1.2); 
            }
            100% { 
                opacity: 0; 
                transform: translateY(-40px) scale(0.8); 
            }
        }
        
        /* äº‹ä»¶å¼¹çª— */
        .event-popup {
            position: absolute;
            background-color: rgba(255, 215, 0, 0.95);
            border: 3px solid #ffd700;
            border-radius: 12px;
            padding: 15px;
            font-weight: bold;
            color: #8b4513;
            font-size: 14px;
            opacity: 0;
            transform: scale(0) rotate(-10deg);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 20;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .event-popup.show {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }
        
        /* æŒ‰é’®æ ·å¼ */
        button {
            padding: 12px 25px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        button:hover {
            background-color: #c0392b;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        button.secondary {
            background-color: #3498db;
        }
        
        button.secondary:hover {
            background-color: #2980b9;
        }
        
        /* çŠ¶æ€æ ·å¼ */
        .status-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #ecf0f1;
            border-radius: 8px;
            border-left: 5px solid #3498db;
        }
        
        .status-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .status-label {
            font-weight: bold;
            color: #7f8c8d;
        }
        
        .status-value {
            color: #2c3e50;
            font-weight: bold;
        }
        
        /* æ—¥å¿—æ ·å¼ */
        .log-container {
            background-color: rgba(255,255,255,0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .log-entry {
            margin-bottom: 12px;
            padding: 12px;
            border-radius: 8px;
            animation: slideIn 0.6s ease;
            position: relative;
            overflow: hidden;
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateX(-30px); 
                height: 0;
                padding: 0 12px;
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
                height: auto;
                padding: 12px;
            }
        }
        
        .log-entry::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }
        
        .log-entry.info {
            background-color: #d4edda;
            color: #155724;
        }
        
        .log-entry.info::before {
            background-color: #28a745;
        }
        
        .log-entry.warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .log-entry.warning::before {
            background-color: #ffc107;
        }
        
        .log-entry.error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .log-entry.error::before {
            background-color: #dc3545;
        }
        
        .log-entry.success {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .log-entry.success::before {
            background-color: #17a2b8;
        }
        
        .log-entry.event {
            background-color: #e2d5f8;
            color: #4a148c;
        }
        
        .log-entry.event::before {
            background-color: #8e24aa;
        }
        
        .log-timestamp {
            font-size: 12px;
            opacity: 0.7;
            margin-right: 10px;
        }
        
        /* æ¸¸æˆçŠ¶æ€ */
        .game-state {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .game-state.playing {
            background-color: #3498db;
            color: white;
        }
        
        .game-state.success {
            background-color: #28a745;
            color: white;
        }
        
        .game-state.failed {
            background-color: #dc3545;
            color: white;
        }
        
        .game-state.waiting {
            background-color: #ffc107;
            color: #856404;
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1> å¯»å®å¤§å†’é™© </h1>
        
        <div class="game-panel">
            <div class="left-section">
                <div class="map-container">
                    <div class="treasure-map" id="treasureMap">
                        <div class="player" id="player"></div>
                        <div class="guard" id="guard"></div>
                        <div class="treasure" id="treasure"></div>
                        <div class="event-popup" id="eventPopup"></div>
                    </div>
                </div>
                
                <div class="log-container" id="logContainer"></div>
            </div>
            
            <div class="info-container">
                <div class="status-container">
                    <div class="game-state waiting" id="gameState">ç­‰å¾…å¼€å§‹</div>
                    
                    <div class="status-section">
                        <div class="status-header">ğŸ® æ¸¸æˆä¿¡æ¯</div>
                        <div class="status-item">
                            <span class="status-label">å½“å‰ä½ç½®:</span>
                            <span class="status-value" id="currentLocation">èµ·ç‚¹</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">æ¸¸æˆé˜¶æ®µ:</span>
                            <span class="status-value" id="gamePhase">æœªå¼€å§‹</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">çŠ¶æ€:</span>
                            <span class="status-value" id="status">å°±ç»ª</span>
                        </div>
                    </div>
                    
                    <div class="status-section">
                        <div class="status-header">ğŸ’° èµ„æº</div>
                        <div class="status-item">
                            <span class="status-label">é‡‘å¸:</span>
                            <span class="status-value" id="gold">100</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">çº¿ç´¢:</span>
                            <span class="status-value" id="clues">0</span>
                        </div>
                    </div>
                    
                    <div class="status-section">
                        <div class="status-header">ğŸ‘¥ æ‰“æ‰‹å›¢é˜Ÿ</div>
                        <div class="status-item">
                            <span class="status-label">å½“å‰æ‰“æ‰‹:</span>
                            <span class="status-value" id="helpers">0</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">æŸå¤±æ‰“æ‰‹:</span>
                            <span class="status-value" id="lostHelpers">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="controls-container">
                    <button onclick="startAdventure()" id="startBtn">å¼€å§‹æ¢é™©</button>
                    <button onclick="resetGame()" id="resetBtn" class="secondary">é‡æ–°å¼€å§‹</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const GAME_CONFIG = {
            initialGold: 100,
            helperCost: 10,
            helperReward: 8,
            helperCompensation: 5,
            clueReward: 20,
            treasureReward: 500
        };
        
        // åŸºäºåŸç‰ˆæ‰©å±•çš„å®è—åœ°å›¾API
        class TreasureMap {
            static locations = {
                // ç²¾ç¡®å¯¹åº”æ–°åœ°å›¾ä¸Šçš„åœ†åœˆä¸­å¿ƒåæ ‡
                library: { name: "å¤è€å›¾ä¹¦é¦†", x: 105, y: 110 }, // å¯¹åº”åœ°å›¾ä¸Šcx="120" cy="125"ï¼Œå‡å»ç©å®¶åŠå¾„15px
                guild: { name: "å†’é™©è€…å·¥ä¼š", x: 205, y: 110 }, // å¯¹åº”åœ°å›¾ä¸Šcx="220" cy="125"ï¼Œå‡å»ç©å®¶åŠå¾„15px
                forest: { name: "ç¥ç§˜æ£®æ—", x: 305, y: 110 }, // å¯¹åº”åœ°å›¾ä¸Šcx="320" cy="125"ï¼Œå‡å»ç©å®¶åŠå¾„15px
                temple: { name: "ç¥åœ£ç¥åº™", x: 465, y: 110 }, // å¯¹åº”åœ°å›¾ä¸Šcx="480" cy="125"ï¼Œå‡å»ç©å®¶åŠå¾„15px
                treasure: { name: "å®è—åœ°ç‚¹", x: 765, y: 110 } // å¯¹åº”åœ°å›¾ä¸Šcx="780" cy="125"ï¼Œå‡å»ç©å®¶åŠå¾„15px
            };
            
            // åŸç‰ˆæ–¹æ³•ä¿ç•™
            static getInitialClue() {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve("åœ¨å¤è€çš„å›¾ä¹¦é¦†é‡Œæ‰¾åˆ°äº†ç¬¬ä¸€ä¸ªçº¿ç´¢...");
                    }, 1200);
                });
            }
        
            static decodeAncientScript(clue) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (!clue) {
                            reject("æ²¡æœ‰çº¿ç´¢å¯ä»¥è§£ç !");
                        }
                        resolve("è§£ç æˆåŠŸ!å®è—åœ¨ä¸€åº§å¤è€çš„ç¥åº™ä¸­...");
                    }, 1800);
                });
            }
        
            static searchTemple(location) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const random = Math.random();
                        if (random < 0.3) {
                            reject("ç³Ÿç³•!é‡åˆ°äº†ç¥åº™å®ˆå«!");
                        }
                        resolve("æ‰¾åˆ°äº†ä¸€ä¸ªç¥ç§˜çš„ç®±å­...");
                    }, 2200);
                });
            }
        
            static openTreasureBox() {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve("æ­å–œ!ä½ æ‰¾åˆ°äº†ä¼ è¯´ä¸­çš„å®è—!");
                    }, 1500);
                });
            }
            
            // æ–°å¢ï¼šé›‡ä½£æ‰“æ‰‹
            static hireHelper() {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const random = Math.random();
                        if (random < 0.5) { // è°ƒæ•´ä¸º50%é›‡ä½£æˆåŠŸç‡ï¼Œç¬¦åˆç”¨æˆ·è¦æ±‚
                            resolve("æˆåŠŸé›‡ä½£äº†ä¸€åæ‰“æ‰‹!");
                        } else {
                            reject("é›‡ä½£å¤±è´¥ï¼Œå€™é€‰äººæ‹’ç»äº†ä½ çš„é‚€è¯·...");
                        }
                    }, 1000);
                });
            }
            
            // ç®€åŒ–ç‰ˆï¼šç©¿è¶Šæ£®æ—
            static crossForest() {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const random = Math.random();
                        if (random < 0.25) { // 25%æ¦‚ç‡è¿·å¤±
                            reject("åœ¨æ£®æ—ä¸­è¿·å¤±äº†æ–¹å‘ï¼Œè€½è¯¯äº†æ—¶é—´...");
                        } else {
                            resolve("æˆåŠŸç©¿è¶Šæ£®æ—...");
                        }
                    }, 2000);
                });
            }
            
            // æœç´¢ç¥åº™
            static searchTemple(location) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const random = Math.random();
                        if (random < 0.2) {
                            reject("ç³Ÿç³•!é‡åˆ°äº†ç¥åº™å®ˆå«!");
                        }
                        resolve("æ‰¾åˆ°äº†ä¸€ä¸ªç¥ç§˜çš„ç®±å­...");
                    }, 2200);
                });
            }
        }
        
        // æ¸¸æˆçŠ¶æ€ç®¡ç†
        class GameState {
            constructor() {
                this.reset();
            }
            
            reset() {
                this.gold = GAME_CONFIG.initialGold;
                this.helpers = 0;
                this.lostHelpers = 0;
                this.clues = 0;
                this.currentLocation = "èµ·ç‚¹";
                this.phase = "æœªå¼€å§‹";
                this.status = "å°±ç»ª";
                this.isPlaying = false;
            }
            
            update(data) {
                Object.assign(this, data);
                this.updateUI();
            }
            
            updateUI() {
                document.getElementById('gold').textContent = this.gold;
                document.getElementById('helpers').textContent = this.helpers;
                document.getElementById('lostHelpers').textContent = this.lostHelpers;
                document.getElementById('clues').textContent = this.clues;
                document.getElementById('currentLocation').textContent = this.currentLocation;
                document.getElementById('gamePhase').textContent = this.phase;
                document.getElementById('status').textContent = this.status;
                
                const gameStateEl = document.getElementById('gameState');
                if (this.isPlaying) {
                    gameStateEl.className = "game-state playing";
                    gameStateEl.textContent = "æ¸¸æˆè¿›è¡Œä¸­";
                } else {
                    if (this.phase === "æˆåŠŸ") {
                        gameStateEl.className = "game-state success";
                        gameStateEl.textContent = "å¯»å®æˆåŠŸ";
                    } else if (this.phase === "å¤±è´¥") {
                        gameStateEl.className = "game-state failed";
                        gameStateEl.textContent = "å¯»å®å¤±è´¥";
                    } else {
                        gameStateEl.className = "game-state waiting";
                        gameStateEl.textContent = "ç­‰å¾…å¼€å§‹";
                    }
                }
            }
        }
        
        // ç®€åŒ–çš„æ¸¸æˆUIç®¡ç†
        class GameUI {
            constructor() {
                this.player = document.getElementById('player');
                this.guard = document.getElementById('guard');
                this.treasure = document.getElementById('treasure');
                this.eventPopup = document.getElementById('eventPopup');
                this.logContainer = document.getElementById('logContainer');
            }
            
            log(message, type = 'info') {
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${type}`;
                logEntry.innerHTML = `<span class="log-timestamp">[${new Date().toLocaleTimeString()}]</span> ${message}`;
                this.logContainer.appendChild(logEntry);
                this.logContainer.scrollTop = this.logContainer.scrollHeight;
            }
            
            showEvent(message, x, y) {
                // ç®€å•çš„äº‹ä»¶æç¤º
                this.log(message, 'event');
            }
            
            createHelper(x, y, index) {
                const helper = document.createElement('div');
                helper.className = 'helper';
                helper.style.left = `${x + (index - 1) * 15}px`;
                helper.style.top = `${y - 10}px`;
                document.getElementById('treasureMap').appendChild(helper);
                return helper;
            }
            
            // ç®€åŒ–çš„çŠ¶æ€æ›´æ–°
            updateGuard(state) {
                this.guard.style.opacity = state === 'show' ? '1' : '0';
            }
            
            updateTreasure(state) {
                this.treasure.style.opacity = state === 'show' ? '1' : '0';
            }
            
            reset() {
                // é‡ç½®ç©å®¶ä½ç½®åˆ°å›¾ä¹¦é¦†ä¸­å¿ƒ
                this.player.style.left = `${TreasureMap.locations.library.x}px`;
                this.player.style.top = `${TreasureMap.locations.library.y}px`;
                
                // éšè—å®ˆå«å’Œå®è—
                this.updateGuard('hide');
                this.updateTreasure('hide');
                
                // æ¸…ç©ºæ—¥å¿—
                this.logContainer.innerHTML = '';
                
                // ç§»é™¤æ‰€æœ‰ä¸´æ—¶å…ƒç´ 
                document.querySelectorAll('.helper').forEach(el => el.remove());
            }
        }
        
        // ç©å®¶è§’è‰²ç®¡ç† - ç®€åŒ–ç‰ˆ
        class Player {
            constructor(ui) {
                this.ui = ui;
                this.helpers = [];
            }
            
            async move(x, y, location) {
                // ç®€å•ç›´æ¥çš„ä½ç½®æ›´æ–°ï¼Œç¡®ä¿å‡†ç¡®
                const playerEl = document.getElementById('player');
                playerEl.style.left = `${x}px`;
                playerEl.style.top = `${y}px`;
                
                this.ui.showEvent(`åˆ°è¾¾${location}`, x + 20, y - 30);
                
                // æ›´æ–°åŠ©æ‰‹ä½ç½®
                this.helpers.forEach((helper, index) => {
                    helper.style.left = `${x + (index - 1) * 15}px`;
                    helper.style.top = `${y - 10}px`;
                });
                
                await delay(800);
            }
            
            hireHelper(count) {
                const playerEl = document.getElementById('player');
                const x = parseInt(playerEl.style.left);
                const y = parseInt(playerEl.style.top);
                
                for (let i = 0; i < count; i++) {
                    const helper = this.ui.createHelper(x, y, this.helpers.length + 1);
                    this.helpers.push(helper);
                }
            }
            
            loseHelper(count) {
                const lostHelpers = Math.min(count, this.helpers.length);
                for (let i = 0; i < lostHelpers; i++) {
                    const helper = this.helpers.pop();
                    helper.remove();
                }
                return lostHelpers;
            }
            
            getHelperCount() {
                return this.helpers.length;
            }
            
            reset() {
                this.helpers.forEach(helper => helper.remove());
                this.helpers = [];
            }
        }
        
        // è¾…åŠ©å‡½æ•°
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        const gameState = new GameState();
        const gameUI = new GameUI();
        const player = new Player(gameUI);
        
        // ä½¿ç”¨async/awaité‡å†™çš„å¯»å®è¿‡ç¨‹ - æœ€ç®€åŒ–ç‰ˆ
        async function findTreasureWithAsyncAwait() {
            gameState.update({ 
                isPlaying: true, 
                phase: "å¼€å§‹æ¢é™©", 
                status: "æ­£åœ¨å¯»æ‰¾çº¿ç´¢",
                currentLocation: "å¤è€å›¾ä¹¦é¦†"
            });
            
            try {
                // é˜¶æ®µ1ï¼šå›¾ä¹¦é¦†è·å–çº¿ç´¢ï¼ˆ100%æˆåŠŸï¼‰
                gameUI.log("å¼€å§‹å¯»å®ä¹‹æ—…ï¼Œé¦–å…ˆå‰å¾€å¤è€å›¾ä¹¦é¦†...");
                await player.move(
                    TreasureMap.locations.library.x, 
                    TreasureMap.locations.library.y, 
                    "å¤è€å›¾ä¹¦é¦†"
                );
                gameState.update({ currentLocation: "å¤è€å›¾ä¹¦é¦†" });
                
                gameUI.log("åœ¨å›¾ä¹¦é¦†ä¸­æœç´¢çº¿ç´¢...");
                const initialClue = await TreasureMap.getInitialClue();
                gameUI.log(initialClue, "success");
                gameState.update({ 
                    clues: gameState.clues + 1, 
                    status: "è§£ç çº¿ç´¢ä¸­"
                });
                
                // é˜¶æ®µ2ï¼šè§£ç çº¿ç´¢
                gameUI.log("å°è¯•è§£ç å¤ä»£æ–‡å­—...");
                const decodedClue = await TreasureMap.decodeAncientScript(initialClue);
                gameUI.log(decodedClue, "success");
                gameState.update({ 
                    clues: gameState.clues + 1, 
                    status: "é›‡ä½£æ‰“æ‰‹"
                });
                
                // é˜¶æ®µ3ï¼šå‰å¾€å·¥ä¼šé›‡ä½£æ‰“æ‰‹
                gameUI.log("å‰å¾€å†’é™©è€…å·¥ä¼šé›‡ä½£æ‰“æ‰‹...");
                await player.move(
                    TreasureMap.locations.guild.x, 
                    TreasureMap.locations.guild.y, 
                    "å†’é™©è€…å·¥ä¼š"
                );
                gameState.update({ currentLocation: "å†’é™©è€…å·¥ä¼š" });
                
                gameUI.log("åœ¨å·¥ä¼šä¸­å¯»æ‰¾åˆé€‚çš„å¸®æ‰‹...");
                
                const hireAttempts = 5; // å›ºå®š5æ¬¡é›‡ä½£å°è¯•
                let actualAttempts = 0;
                
                for (let i = 0; i < hireAttempts; i++) {
                    if (gameState.gold >= GAME_CONFIG.helperCost) {
                        actualAttempts++;
                        try {
                            gameState.update({ gold: gameState.gold - GAME_CONFIG.helperCost });
                            const hireResult = await TreasureMap.hireHelper();
                            gameUI.log(hireResult, "success");
                            player.hireHelper(1);
                            gameState.update({ helpers: gameState.helpers + 1 });
                            await delay(500);
                        } catch (error) {
                            gameUI.log(error, "warning");
                            gameState.update({ gold: gameState.gold + GAME_CONFIG.helperCost });
                        }
                    } else {
                        gameUI.log("é‡‘å¸ä¸è¶³ï¼Œæ— æ³•ç»§ç»­é›‡ä½£æ‰“æ‰‹...", "warning");
                        break;
                    }
                }
                
                gameUI.log(`é›‡ä½£ç»“æŸï¼Œå…±æœ‰${gameState.helpers}åæ‰“æ‰‹`, "info");
                gameState.update({ status: "ç©¿è¶Šæ£®æ—ä¸­" });
                
                // é˜¶æ®µ4ï¼šç©¿è¶Šæ£®æ—
                gameUI.log("å‰å¾€æ£®æ—ï¼Œå‡†å¤‡å‰å¾€ç¥åº™...");
                await player.move(
                    TreasureMap.locations.forest.x, 
                    TreasureMap.locations.forest.y, 
                    "ç¥ç§˜æ£®æ—"
                );
                gameState.update({ currentLocation: "ç¥ç§˜æ£®æ—" });
                
                gameUI.log("ç©¿è¶Šæ£®æ—ä¸­...");
                const forestResult = await TreasureMap.crossForest();
                gameUI.log(forestResult, "success");
                gameState.update({ status: "å‰å¾€ç¥åº™" });
                
                // é˜¶æ®µ5ï¼šå‰å¾€ç¥åº™
                gameUI.log("å‰å¾€ç¥åº™...");
                await player.move(
                    TreasureMap.locations.temple.x, 
                    TreasureMap.locations.temple.y, 
                    "ç¥åœ£ç¥åº™"
                );
                gameState.update({ currentLocation: "ç¥åœ£ç¥åº™" });
                
                // æ˜¾ç¤ºå®ˆå«
                gameUI.updateGuard('show');
                gameUI.log("ç¥åº™å®ˆå«æ­£åœ¨å·¡é€»...", "warning");
                gameState.update({ status: "ä¸å®ˆå«å‘¨æ—‹" });
                
                // é˜¶æ®µ6ï¼šé­é‡å®ˆå«
                gameUI.log("å®ˆå«å‘ç°äº†ä½ ï¼Œå¼€å§‹è¿½å‡»...");
                
                if (gameState.helpers > 0) {
                    // æœ‰æ‰“æ‰‹ï¼šéšæœºæŸå¤±0-2ä½æ‰“æ‰‹
                    const lostHelpers = Math.floor(Math.random() * 3); // 0-2ä½
                    
                    if (lostHelpers > 0) {
                        const actualLost = Math.min(lostHelpers, gameState.helpers);
                        player.loseHelper(actualLost);
                        gameState.update({ 
                            helpers: gameState.helpers - actualLost,
                            lostHelpers: gameState.lostHelpers + actualLost
                        });
                        gameUI.log(`ä¸å®ˆå«æˆ˜æ–—ï¼ŒæŸå¤±äº†${actualLost}åæ‰“æ‰‹...`, "warning");
                    } else {
                        gameUI.log("æˆåŠŸå‡»é€€å®ˆå«...", "success");
                    }
                } else {
                    // æ²¡æœ‰æ‰“æ‰‹ï¼šæœ‰æ¦‚ç‡è¢«æŠ“ä½
                    const caughtChance = Math.random();
                    if (caughtChance < 0.7) { // 70%æ¦‚ç‡è¢«æŠ“ä½
                        gameUI.log("æ²¡æœ‰æ‰“æ‰‹ä¿æŠ¤ï¼Œè¢«å®ˆå«æŠ“ä½äº†!");
                        throw new Error("æ²¡æœ‰æ‰“æ‰‹ä¿æŠ¤ï¼Œè¢«å®ˆå«æŠ“ä½ï¼Œå¯»å®å¤±è´¥!");
                    } else {
                        gameUI.log("å¹¸è¿åœ°é€ƒè„±äº†å®ˆå«çš„è¿½å‡»...", "success");
                    }
                }
                
                // é˜¶æ®µ7ï¼šæœç´¢ç¥åº™
                gameState.update({ status: "æœç´¢å®è—" });
                gameUI.log("åœ¨ç¥åº™ä¸­æœç´¢å®è—...");
                
                // é˜¶æ®µ8ï¼šå‰å¾€å®è—ç‚¹
                gameUI.log("æ‰¾åˆ°äº†å®è—çš„ä½ç½®ï¼Œå‰å¾€å®è—ç‚¹...");
                await player.move(
                    TreasureMap.locations.treasure.x, 
                    TreasureMap.locations.treasure.y, 
                    "å®è—åœ°ç‚¹"
                );
                gameState.update({ currentLocation: "å®è—åœ°ç‚¹" });
                
                // é˜¶æ®µ9ï¼šæ‰“å¼€å®ç®±
                gameState.update({ status: "æ‰“å¼€å®ç®±" });
                gameUI.log("å°è¯•æ‰“å¼€ç¥ç§˜å®ç®±...");
                const treasureResult = await TreasureMap.openTreasureBox();
                gameUI.log(treasureResult, "success");
                
                // é˜¶æ®µ10ï¼šè·å¾—å®è—
                gameUI.log("æ‰¾åˆ°äº†ä¼ è¯´ä¸­çš„å®è—ï¼", "success");
                
                // æ˜¾ç¤ºå®è—
                gameUI.updateTreasure('show');
                
                // æ”¯ä»˜æ‰“æ‰‹æŠ¥é…¬
                if (gameState.helpers > 0) {
                    const payment = gameState.helpers * GAME_CONFIG.helperReward;
                    gameState.update({ gold: gameState.gold - payment });
                    gameUI.log(`æ”¯ä»˜${payment}é‡‘å¸ç»™${gameState.helpers}åæ‰“æ‰‹ä½œä¸ºæŠ¥é…¬`, "info");
                }
                
                // è·å¾—å®è—å¥–åŠ±
                gameState.update({ gold: gameState.gold + GAME_CONFIG.treasureReward });
                gameUI.log(`è·å¾—äº†${GAME_CONFIG.treasureReward}é‡‘å¸çš„å®è—å¥–åŠ±ï¼`, "success");
                
                gameUI.log("æ­å–œï¼ä½ æˆåŠŸå®Œæˆäº†å¯»å®å¤§å†’é™©ï¼", "event");
                gameState.update({ 
                    isPlaying: false, 
                    phase: "æˆåŠŸ", 
                    status: "å®Œæˆ"
                });
                
            } catch (error) {
                gameUI.log(`æ¢é™©å¤±è´¥: ${error}`, "error");
                gameState.update({ 
                    isPlaying: false, 
                    phase: "å¤±è´¥", 
                    status: "å¤±è´¥"
                });
            }
        }
        
        // æ¸¸æˆæ§åˆ¶å‡½æ•°
        function startAdventure() {
            if (!gameState.isPlaying) {
                resetGame();
                findTreasureWithAsyncAwait();
            }
        }
        
        function resetGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.reset();
            player.reset();
            gameUI.reset();
            
            // æ›´æ–°UI
            gameState.updateUI();
            gameUI.log("æ¸¸æˆå·²é‡ç½®ï¼Œç‚¹å‡»å¼€å§‹æ¢é™©æŒ‰é’®å¼€å§‹æ¸¸æˆ...");
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        resetGame();
    </script>
</body>
</html>
