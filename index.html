<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寻宝大冒险 - 简化版</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8f0;
        }
        .log-container {
            border: 1px solid #ccc;
            padding: 15px;
            min-height: 300px;
            margin-top: 20px;
            background-color: #fff;
            border-radius: 8px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 8px 0;
            padding: 8px;
            border-radius: 4px;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .success { background-color: #e6f7e6; border-left: 3px solid #4caf50; }
        .info { background-color: #e3f2fd; border-left: 3px solid #2196f3; }
        .warning { background-color: #fff8e1; border-left: 3px solid #ffc107; }
        .error { background-color: #ffebee; border-left: 3px solid #f44336; }
        button {
            padding: 10px 20px;
            background-color: #2196f3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background-color: #0b7dda; }
        .status-bar {
            margin: 15px 0;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>寻宝大冒险 - 简化版</h1>
    <p>点击开始按钮，体验简单的寻宝之旅！</p>
    <div class="status-bar">
        状态: 未开始 | 金币: 50 | 打手: 0人
    </div>
    <button onclick="startAdventure()">开始探险</button>
    <div class="log-container" id="logContainer"></div>

    <script>
        // 简单的游戏状态
        let gold = 50;
        let helpers = 0;
        
        // 核心的寻宝功能
        class SimpleTreasureMap {
            // 获取线索
            static async getClue() {
                await delay(1000);
                return "在古老图书馆找到了第一个线索...";
            }
            
            // 解码线索
            static async decodeClue() {
                await delay(1500);
                return "解码成功！宝藏在古老神庙中";
            }
            
            // 雇佣打手
            static async hireHelper() {
                await delay(1000);
                // 60%成功率
                return Math.random() < 0.6;
            }
            
            // 检查陷阱
            static async checkTrap() {
                await delay(800);
                // 25%概率遇到陷阱
                if (Math.random() < 0.25) {
                    return { trapped: true, lost: 1 }; // 简单固定损失1人
                }
                return { trapped: false, lost: 0 };
            }
            
            // 搜索神庙
            static async searchTemple(helperCount) {
                await delay(2000);
                // 成功率：30% + 10%×打手数
                const successRate = 0.3 + (helperCount * 0.1);
                return Math.random() < successRate;
            }
        }
        
        // 辅助函数：延迟
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // 日志函数
        function log(message, type = "info") {
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }
        
        // 更新状态
        function updateStatus(status) {
            document.querySelector('.status-bar').textContent = 
                `状态: ${status} | 金币: ${gold} | 打手: ${helpers}人`;
        }
        
        // 主游戏流程 - 使用async/await
        async function startAdventure() {
            // 重置游戏
            gold = 50;
            helpers = 0;
            document.getElementById('logContainer').innerHTML = '';
            document.querySelector('button').disabled = true;
            
            try {
                log("开始寻宝之旅！", "info");
                updateStatus("开始探险");
                
                // 1. 获取线索
                log("寻找线索中...", "info");
                const clue = await SimpleTreasureMap.getClue();
                log(clue, "success");
                
                // 2. 解码线索
                log("解码古代文字...", "info");
                const decoded = await SimpleTreasureMap.decodeClue();
                log(decoded, "success");
                updateStatus("解码完成");
                
                // 3. 雇佣打手（简单版本：尝试3次）
                log("开始雇佣打手（每次5金币）", "info");
                for (let i = 0; i < 3; i++) {
                    if (gold < 5) break;
                    
                    gold -= 5; // 先扣钱
                    const hired = await SimpleTreasureMap.hireHelper();
                    
                    if (hired) {
                        helpers++;
                        log(`雇佣成功！现有打手: ${helpers}人`, "success");
                    } else {
                        log("雇佣失败，钱白花了", "warning");
                    }
                    updateStatus("雇佣中");
                }
                
                log(`雇佣结束，共有${helpers}名打手`, "info");
                
                // 4. 前往神庙（可能遇到陷阱）
                log("前往神庙途中...", "info");
                const trap = await SimpleTreasureMap.checkTrap();
                
                if (trap.trapped) {
                    helpers = Math.max(0, helpers - trap.lost);
                    log(`遭遇陷阱！损失${trap.lost}人，剩余${helpers}人`, "warning");
                } else {
                    log("安全到达神庙", "success");
                }
                updateStatus("抵达神庙");
                
                // 5. 搜索神庙
                log("在神庙中搜索宝藏...", "info");
                const found = await SimpleTreasureMap.searchTemple(helpers);
                
                if (found) {
                    log("找到了宝藏箱子！", "success");
                    
                    // 6. 打开宝箱（需要支付打手报酬）
                    const payment = helpers * 5;
                    if (gold >= payment) {
                        gold -= payment;
                        log(`支付${payment}金币报酬，成功获得宝藏！`, "success");
                        log(`剩余金币: ${gold}`, "info");
                        updateStatus("寻宝成功");
                    } else {
                        throw new Error(`需要${payment}金币但只有${gold}金币，打手们抢走了宝藏！`);
                    }
                } else {
                    throw new Error("搜索失败，没有找到宝藏");
                }
                
            } catch (error) {
                log(`探险失败: ${error.message}`, "error");
                updateStatus("失败");
            } finally {
                document.querySelector('button').disabled = false;
                log("游戏结束，点击按钮重新开始", "info");
            }
        }
    </script>
</body>
</html>
